
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>I. Kubernetes使用Traefik反向代理 · maniafish's technology blog</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="mania_fish<mania_fish@163.com>">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-base16-ateliersulphurpool.light.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="configmap.html" />
    
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://github.com/maniafish/tech_talk/" target="_blank" class="custom-link">github 主页</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    git相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../git/user.html">
            
                <a href="../git/user.html">
            
                    
                    I. 为不同的git项目配置各自独立的用户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../git/gitbook.html">
            
                <a href="../git/gitbook.html">
            
                    
                    II. gitbook的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    linux相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../linux/vim_replace.html">
            
                <a href="../linux/vim_replace.html">
            
                    
                    I. vim替换特殊符号
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../linux/vim_paste.html">
            
                <a href="../linux/vim_paste.html">
            
                    
                    II. vim剪贴板的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../linux/vim_conf.html">
            
                <a href="../linux/vim_conf.html">
            
                    
                    III. vim的插件及配置
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../linux/ab.html">
            
                <a href="../linux/ab.html">
            
                    
                    IV. ab压测工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../linux/zsh.html">
            
                <a href="../linux/zsh.html">
            
                    
                    V. 非root用户安装终极shell zsh
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../linux/plantuml.html">
            
                <a href="../linux/plantuml.html">
            
                    
                    VI. Sublime Text + PlantUML高效画图
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    mysql数据库相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../mysql/sql_mode.html">
            
                <a href="../mysql/sql_mode.html">
            
                    
                    I. 浅谈sql_mode对数据库的影响
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    python相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../python/character.html">
            
                <a href="../python/character.html">
            
                    
                    I. 浅析json dump的字符编码问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../python/dbutils.html">
            
                <a href="../python/dbutils.html">
            
                    
                    II. python数据库连接池DBUtils
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    golang相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../golang/performance.html">
            
                <a href="../golang/performance.html">
            
                    
                    I. Go的性能指标
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../golang/heap_stack.html">
            
                <a href="../golang/heap_stack.html">
            
                    
                    II. Go的堆栈分配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../golang/gc.html">
            
                <a href="../golang/gc.html">
            
                    
                    III. Go的垃圾回收
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../golang/goroutine.html">
            
                <a href="../golang/goroutine.html">
            
                    
                    IV. Go的协程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../golang/stack_trace.html">
            
                <a href="../golang/stack_trace.html">
            
                    
                    V. Go的调试信息
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../golang/composition.html">
            
                <a href="../golang/composition.html">
            
                    
                    VI. Go的interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../golang/operator.html">
            
                <a href="../golang/operator.html">
            
                    
                    VII. Go的变量作用域
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../golang/slice.html">
            
                <a href="../golang/slice.html">
            
                    
                    VIII. Go的slice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../golang/defer.html">
            
                <a href="../golang/defer.html">
            
                    
                    IX. Go的defer处理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../golang/rand.html">
            
                <a href="../golang/rand.html">
            
                    
                    X. Go随机数生成的并发安全问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../go_tool/go_test.html">
            
                <a href="../go_tool/go_test.html">
            
                    
                    XI. Go程序基准测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../go_tool/delve.html">
            
                <a href="../go_tool/delve.html">
            
                    
                    XII. Go调试工具delve
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../go_tool/trace.html">
            
                <a href="../go_tool/trace.html">
            
                    
                    XIII. Go程序运行跟踪器trace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../go_tool/go-torch.html">
            
                <a href="../go_tool/go-torch.html">
            
                    
                    XIV. Go代码调优利器pprof + go-torch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../golang/container.html">
            
                <a href="../golang/container.html">
            
                    
                    XV. Go实现队列、堆、栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../golang/compare.md">
            
                <span>
            
                    
                    XVI. (TODO)Go的大小比较
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Kubernetes相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.7.1" data-path="traefik.html">
            
                <a href="traefik.html">
            
                    
                    I. Kubernetes使用Traefik反向代理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="configmap.html">
            
                <a href="configmap.html">
            
                    
                    II. ConfigMap的使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="commands.html">
            
                <a href="commands.html">
            
                    
                    附. 部分指令参考
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Kafka相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../kafka/quick_start.html">
            
                <a href="../kafka/quick_start.html">
            
                    
                    I. Kafka入门
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    网络编程相关
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../network/chunk.html">
            
                <a href="../network/chunk.html">
            
                    
                    I. HTTP协议之chunk(分块传输编码)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    全栈开发相关(Gin-Vue-Admin)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../gin-vue-admin/install.html">
            
                <a href="../gin-vue-admin/install.html">
            
                    
                    I. 安装和启动
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../gin-vue-admin/add_module.html">
            
                <a href="../gin-vue-admin/add_module.html">
            
                    
                    II. 运用脚手架添加菜单
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.2.1" data-path="../gin-vue-admin/project_a.html">
            
                <a href="../gin-vue-admin/project_a.html">
            
                    
                    示例代码
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >I. Kubernetes使用Traefik反向代理</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#traefik"><b>1. </b>Traefik</a></li><li><span class="title-icon "></span><a href="#&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;deployment&#x6A21;&#x5F0F;"><b>2. </b>&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;(Deployment&#x6A21;&#x5F0F;)</a></li><ul><li><span class="title-icon "></span><a href="#&#x51C6;&#x5907;&#x5DE5;&#x4F5C;"><b>2.1. </b>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</a></li><li><span class="title-icon "></span><a href="#&#x8FD0;&#x884C;traefik"><b>2.2. </b>&#x8FD0;&#x884C;Traefik</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;"><b>2.3. </b>&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;</a></li></ul><li><span class="title-icon "></span><a href="#&#x901A;&#x8FC7;configmap&#x5BF9;traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;"><b>3. </b>&#x901A;&#x8FC7;ConfigMap&#x5BF9;Traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</a></li><li><span class="title-icon "></span><a href="#&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;"><b>4. </b>&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;</a></li><li><span class="title-icon "></span><a href="#&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><b>5. </b>&#x8D1F;&#x8F7D;&#x5747;&#x8861;</a></li><li><span class="title-icon "></span><a href="#&#x7070;&#x5EA6;&#x53D1;&#x5E03;"><b>6. </b>&#x7070;&#x5EA6;&#x53D1;&#x5E03;</a></li><ul><li><span class="title-icon "></span><a href="#&#x5E94;&#x7528;&#x90E8;&#x7F72;"><b>6.1. </b>&#x5E94;&#x7528;&#x90E8;&#x7F72;</a></li><li><span class="title-icon "></span><a href="#&#x5E94;&#x7528;&#x5347;&#x7EA7;"><b>6.2. </b>&#x5E94;&#x7528;&#x5347;&#x7EA7;</a></li><ul><li><span class="title-icon "></span><a href="#&#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;"><b>6.2.1. </b>&#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;</a></li><li><span class="title-icon "></span><a href="#50&#x7070;&#x5EA6;"><b>6.2.2. </b>&quot;50%&quot;&#x7070;&#x5EA6;</a></li><li><span class="title-icon "></span><a href="#&#x7CBE;&#x51C6;&#x7070;&#x5EA6;"><b>6.2.3. </b>&#x7CBE;&#x51C6;&#x7070;&#x5EA6;</a></li></ul></ul><li><span class="title-icon "></span><a href="#ip&#x9650;&#x5236;"><b>7. </b>IP&#x9650;&#x5236;</a></li><li><span class="title-icon "></span><a href="#&#x5B9A;&#x5236;header"><b>8. </b>&#x5B9A;&#x5236;Header</a></li></ul></div><a href="#traefik" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h4 id="kubernetes&#x4F7F;&#x7528;traefik&#x53CD;&#x5411;&#x4EE3;&#x7406;"><a name="kubernetes&#x4F7F;&#x7528;traefik&#x53CD;&#x5411;&#x4EE3;&#x7406;" class="anchor-navigation-ex-anchor" href="#kubernetes&#x4F7F;&#x7528;traefik&#x53CD;&#x5411;&#x4EE3;&#x7406;"><i class="fa fa-link" aria-hidden="true"></i></a><font color="blue">Kubernetes&#x4F7F;&#x7528;Traefik&#x53CD;&#x5411;&#x4EE3;&#x7406;</font></h4>
<hr>
<h1 id="traefik"><a name="traefik" class="anchor-navigation-ex-anchor" href="#traefik"><i class="fa fa-link" aria-hidden="true"></i></a>1. Traefik</h1>
<p>Traefik&#x662F;&#x4E00;&#x4E2A;&#x4E91;&#x539F;&#x751F;&#x8FB9;&#x754C;&#x7F51;&#x5173;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;http&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x548C;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;k8s&#x96C6;&#x7FA4;&#x7684;Ingress Controller&#xFF0C;&#x7ED3;&#x5408;Ingress&#x5B9E;&#x73B0;k8s&#x7684;&#x670D;&#x52A1;&#x6CE8;&#x518C;&#x548C;&#x8DEF;&#x7531;&#x7B49;&#x529F;&#x80FD;&#x3002;</p>
<ul>
<li><a href="https://traefik.io/" target="_blank">&#x5B98;&#x7F51;&#x5730;&#x5740;</a></li>
<li><a href="https://github.com/containous/traefik" target="_blank">github&#x5730;&#x5740;</a></li>
</ul>
<h1 id="&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;deployment&#x6A21;&#x5F0F;"><a name="&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;deployment&#x6A21;&#x5F0F;" class="anchor-navigation-ex-anchor" href="#&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;deployment&#x6A21;&#x5F0F;"><i class="fa fa-link" aria-hidden="true"></i></a>2. &#x53CD;&#x5411;&#x4EE3;&#x7406;&#x5B9E;&#x8DF5;(Deployment&#x6A21;&#x5F0F;)</h1>
<h2 id="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;"><a name="&#x51C6;&#x5907;&#x5DE5;&#x4F5C;" class="anchor-navigation-ex-anchor" href="#&#x51C6;&#x5907;&#x5DE5;&#x4F5C;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1. &#x51C6;&#x5907;&#x5DE5;&#x4F5C;</h2>
<ol>
<li><p>&#x542F;&#x52A8;k8s: mac&#x4E0B;&#x8F7D;&#x684C;&#x9762;&#x7248;docker&#xFF0C;&#x6253;&#x5F00;<code>Enable Kubernetes</code>&#x5373;&#x53EF;&#x542F;&#x52A8;</p>
<p> <img src="image/traefik_1.png" alt=""></p>
</li>
<li><p><a href="https://kubernetes.io/docs/tasks/tools/install-minikube/" target="_blank">&#x5B89;&#x88C5;MiniKube</a></p>
</li>
<li>&#x542F;&#x52A8;MiniKube: <code>minikube start</code></li>
</ol>
<h2 id="&#x8FD0;&#x884C;traefik"><a name="&#x8FD0;&#x884C;traefik" class="anchor-navigation-ex-anchor" href="#&#x8FD0;&#x884C;traefik"><i class="fa fa-link" aria-hidden="true"></i></a>2.2. &#x8FD0;&#x884C;Traefik</h2>
<ol>
<li>&#x4E0B;&#x8F7D;github&#x4EE3;&#x7801;: <code>git clone https://github.com/containous/traefik</code></li>
<li>&#x8FDB;&#x5165;<code>traefik/examples/k8s</code>&#x76EE;&#x5F55;</li>
<li><p>deployment&#x6A21;&#x5F0F;&#x90E8;&#x7F72;&#xFF0C;&#x521B;&#x5EFA;&#x5BF9;&#x5916;&#x670D;&#x52A1;&#xFF1A;<code>kubectl create -f traefik-deployment.yaml</code></p>
<blockquote>
<ul>
<li>&#x52A0;&#x8F7D;&#x8D44;&#x6E90;: <code>kubectl apply -f traefik-deployment.yaml</code></li>
<li>&#x53BB;&#x9664;&#x8D44;&#x6E90;&#xFF1A;<code>kubectl delete -f traefik-deployment.yaml</code></li>
</ul>
</blockquote>
<pre class="language-"><code class="lang-js"> kind<span class="token punctuation">:</span> Service
 apiVersion<span class="token punctuation">:</span> v1
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>service
   namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
 spec<span class="token punctuation">:</span>
   selector<span class="token punctuation">:</span>
     k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
   ports<span class="token punctuation">:</span>
     <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
       port<span class="token punctuation">:</span> <span class="token number">80</span>
       nodePort<span class="token punctuation">:</span> <span class="token number">32044</span>
       name<span class="token punctuation">:</span> web
     <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
       port<span class="token punctuation">:</span> <span class="token number">8080</span>
       nodePort<span class="token punctuation">:</span> <span class="token number">30423</span>
       name<span class="token punctuation">:</span> admin
   type<span class="token punctuation">:</span> NodePort
</code></pre>
<p> &#x9ED8;&#x8BA4;<code>type: NodePort</code>&#x4F1A;&#x968F;&#x673A;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5BF9;&#x5916;&#x670D;&#x52A1;&#x7AEF;&#x53E3;&#xFF0C;&#x82E5;&#x9700;&#x8981;&#x8BBE;&#x5B9A;&#x6307;&#x5B9A;&#x7684;&#x7AEF;&#x53E3;&#xFF0C;&#x8981;&#x5728;ports&#x91CC;&#x914D;&#x7F6E;&#x5B9E;&#x9645;&#x7684;nodePort</p>
</li>
<li><p><code>kubectl get pods -n kube-system</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>trafik-ingress-controller</code>&#x5DF2;&#x542F;&#x52A8;</p>
<pre class="language-"><code class="lang-js"> <span class="token constant">NAME</span>                                         <span class="token constant">READY</span>     <span class="token constant">STATUS</span>    <span class="token constant">RESTARTS</span>   <span class="token constant">AGE</span>
 coredns<span class="token operator">-</span><span class="token number">86</span>c58d9df4<span class="token operator">-</span>cffc8                     <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">8</span>h
 coredns<span class="token operator">-</span><span class="token number">86</span>c58d9df4<span class="token operator">-</span>n5dsv                     <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">8</span>h
 etcd<span class="token operator">-</span>minikube                                <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">7</span>h
 kube<span class="token operator">-</span>addon<span class="token operator">-</span>manager<span class="token operator">-</span>minikube                  <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">7</span>h
 kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>minikube                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">7</span>h
 kube<span class="token operator">-</span>controller<span class="token operator">-</span>manager<span class="token operator">-</span>minikube             <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">7</span>h
 kube<span class="token operator">-</span>proxy<span class="token operator">-</span>ltkl5                             <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">8</span>h
 kube<span class="token operator">-</span>scheduler<span class="token operator">-</span>minikube                      <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">1</span>          <span class="token number">7</span>h
 storage<span class="token operator">-</span>provisioner                          <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">8</span>h
 traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller<span class="token operator">-</span><span class="token number">8</span>c8b85bbc<span class="token operator">-</span><span class="token number">9</span>kn5p   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>       Running   <span class="token number">0</span>          <span class="token number">11</span>m
</code></pre>
</li>
<li><p><code>kubectl get services -n kube-system</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x7684;ip&#x548C;&#x7AEF;&#x53E3; </p>
<pre class="language-"><code class="lang-js"> <span class="token constant">NAME</span>                      <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>     <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>                       <span class="token constant">AGE</span>
 kube<span class="token operator">-</span>dns                  ClusterIP   <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.10</span>     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">53</span><span class="token operator">/</span><span class="token constant">UDP</span><span class="token punctuation">,</span><span class="token number">53</span><span class="token operator">/</span><span class="token constant">TCP</span>                 <span class="token number">7</span>h
 traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>service   NodePort    <span class="token number">10.98</span><span class="token number">.51</span><span class="token number">.165</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token punctuation">:</span><span class="token number">32044</span><span class="token operator">/</span><span class="token constant">TCP</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">:</span><span class="token number">30423</span><span class="token operator">/</span><span class="token constant">TCP</span>   <span class="token number">11</span>m
</code></pre>
<blockquote>
<ul>
<li>&#x8BBF;&#x95EE;<code>$(minikube ip):32044</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;&#x5BF9;&#x5916;&#x7AEF;&#x53E3;&#x8FD4;&#x56DE;&#x7684;&#x9875;&#x9762;</li>
<li>&#x8BBF;&#x95EE;<code>$(minikube ip):30423</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x5F53;&#x524D;Traefik&#x7684;dashboard</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;"><a name="&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;"><i class="fa fa-link" aria-hidden="true"></i></a>2.3. &#x914D;&#x7F6E;&#x670D;&#x52A1;&#x8DEF;&#x7531;</h2>
<ol>
<li><p>&#x542F;&#x52A8;&#x540E;&#x7AEF;&#x670D;&#x52A1;</p>
<pre class="language-"><code class="lang-js"> kubectl apply <span class="token operator">-</span>f cheese<span class="token operator">-</span>deployments<span class="token punctuation">.</span>yaml
 kubectl apply <span class="token operator">-</span>f cheese<span class="token operator">-</span>services<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p><code>kubectl get services</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x542F;&#x52A8;&#x7684;TYPE&#x90FD;&#x662F;ClusterIP&#xFF0C;&#x96C6;&#x7FA4;&#x5185;&#x90E8;&#x670D;&#x52A1;&#xFF0C;&#x4E0D;&#x5BF9;&#x5916;&#x66B4;&#x9732;&#x7AEF;&#x53E3;</p>
<pre class="language-"><code class="lang-js"> <span class="token constant">NAME</span>          <span class="token constant">TYPE</span>        <span class="token constant">CLUSTER</span><span class="token operator">-</span><span class="token constant">IP</span>       <span class="token constant">EXTERNAL</span><span class="token operator">-</span><span class="token constant">IP</span>   <span class="token constant">PORT</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">)</span>   <span class="token constant">AGE</span>
 cheddar       ClusterIP   <span class="token number">10.98</span><span class="token number">.97</span><span class="token number">.163</span>     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>    <span class="token number">17</span>s
 kubernetes    ClusterIP   <span class="token number">10.96</span><span class="token number">.0</span><span class="token number">.1</span>        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span><span class="token operator">/</span><span class="token constant">TCP</span>   <span class="token number">7</span>h
 stilton       ClusterIP   <span class="token number">10.108</span><span class="token number">.91</span><span class="token number">.83</span>     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>    <span class="token number">17</span>s
 wensleydale   ClusterIP   <span class="token number">10.110</span><span class="token number">.187</span><span class="token number">.225</span>   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span><span class="token operator">/</span><span class="token constant">TCP</span>    <span class="token number">17</span>s
</code></pre>
</li>
<li><p>&#x901A;&#x8FC7;Ingress&#x5EFA;&#x7ACB;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#xFF1A;<code>kubectl apply -f cheeses-ingress.yaml</code>&#xFF0C;&#x914D;&#x7F6E;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre class="language-"><code class="lang-js"> apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Ingress
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> cheeses
   annotations<span class="token punctuation">:</span>
     traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
 spec<span class="token punctuation">:</span>
   rules<span class="token punctuation">:</span>
   <span class="token operator">-</span> host<span class="token punctuation">:</span> stilton<span class="token punctuation">.</span>minikube
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> stilton
           servicePort<span class="token punctuation">:</span> http
   <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>cheddar
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> cheddar
           servicePort<span class="token punctuation">:</span> http
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>wensleydale
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> wensleydale
           servicePort<span class="token punctuation">:</span> http
</code></pre>
<blockquote>
<ul>
<li><code>traefik.frontend.rule.type: PathPrefixStrip</code>&#x8868;&#x793A;&#x4F7F;&#x7528;&#x8DEF;&#x7531;&#x524D;&#x7F00;&#x5339;&#x914D;&#xFF0C;&#x4E14;&#x8F6C;&#x53D1;&#x5230;&#x540E;&#x7AEF;&#x524D;&#x4F1A;&#x5C06;&#x5339;&#x914D;&#x5230;&#x7684;&#x524D;&#x7F00;&#x53BB;&#x6389;(strip)&#xFF1B;&#x56E0;&#x6B64;&#x5F53;&#x4F60;&#x8BBF;&#x95EE;<code>/cheddar/call</code>&#x65F6;&#x5019;&#xFF0C;&#x8F6C;&#x53D1;&#x5230;&#x540E;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;path&#x4F1A;&#x53D8;&#x6210;<code>/call</code>&#xFF1B;&#x5982;&#x679C;&#x53EA;&#x9700;&#x8981;&#x505A;&#x524D;&#x7F00;&#x5339;&#x914D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>PathPrefix</code></li>
<li>&#x76EE;&#x524D;<code>traefik.ingress.kubernetes.io/rule-type</code>&#x652F;&#x6301;Path, PathPrefix, PathStrip, PathPrefixStrip&#x8FD9;&#x4E94;&#x79CD;&#x89C4;&#x5219;</li>
<li>Traefik&#x7684;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x652F;&#x6301;&#x6B63;&#x5219;&#x5339;&#x914D;&#xFF0C;&#x683C;&#x5F0F;&#x4E3A;<code>$param:$pattern</code>&#xFF0C;&#x82E5;<code>:$pattern</code>&#x4E3A;&#x7A7A;&#xFF0C;&#x5219;&#x91C7;&#x53D6;&#x901A;&#x914D;&#x7B26;&#x5339;&#x914D;&#xFF1B;&#x5982;<code>/cheddar/{name}/{id:[0-9]+}</code>&#xFF0C;&#x5339;&#x914D;<code>/cheddar/a/123</code>&#x7B49;&#x3002;Traefik&#x91C7;&#x7528;<a href="https://github.com/google/re2/wiki/Syntax" target="_blank">golang&#x7684;&#x6B63;&#x5219;&#x89C4;&#x5219;</a></li>
<li><code>PathPrefixStrip</code>&#x4E0D;&#x652F;&#x6301;&#x53BB;&#x9664;&#x5E26;&#x6709;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;&#x7684;&#x8DEF;&#x5F84;</li>
</ul>
</blockquote>
</li>
<li><p><code>kubectl describe ingress cheeses</code> &#x67E5;&#x770B; Ingress</p>
<pre class="language-"><code class="lang-js"> Name<span class="token punctuation">:</span>             cheeses
 Namespace<span class="token punctuation">:</span>        <span class="token keyword">default</span>
 Address<span class="token punctuation">:</span>
 Default backend<span class="token punctuation">:</span>  <span class="token keyword">default</span><span class="token operator">-</span>http<span class="token operator">-</span>backend<span class="token punctuation">:</span><span class="token number">80</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span class="token punctuation">)</span>
 Rules<span class="token punctuation">:</span>
   Host              Path  Backends
   <span class="token operator">--</span><span class="token operator">--</span>              <span class="token operator">--</span><span class="token operator">--</span>  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
   stilton<span class="token punctuation">.</span>minikube
                     <span class="token operator">/</span>   stilton<span class="token punctuation">:</span><span class="token function">http</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span class="token punctuation">)</span>
   cheeses<span class="token punctuation">.</span>minikube
                     <span class="token operator">/</span>cheddar       cheddar<span class="token punctuation">:</span><span class="token function">http</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span class="token punctuation">)</span>
                     <span class="token operator">/</span>wensleydale   wensleydale<span class="token punctuation">:</span><span class="token function">http</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span>none<span class="token operator">&gt;</span><span class="token punctuation">)</span>
 Annotations<span class="token punctuation">:</span>
   kubectl<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>last<span class="token operator">-</span>applied<span class="token operator">-</span>configuration<span class="token punctuation">:</span>  <span class="token punctuation">{</span><span class="token string">&quot;apiVersion&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;extensions/v1beta1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;kind&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Ingress&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;metadata&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;annotations&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;traefik.frontend.rule.type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;PathPrefixStrip&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;cheeses&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;namespace&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;spec&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;rules&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;stilton.minikube&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;paths&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;backend&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;serviceName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;stilton&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;servicePort&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;host&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;cheeses.minikube&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;paths&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;backend&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;serviceName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;cheddar&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;servicePort&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/cheddar&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;backend&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;serviceName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;wensleydale&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;servicePort&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/wensleydale&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

   traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span>  PathPrefixStrip
 Events<span class="token punctuation">:</span>                        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre>
</li>
<li><p>&#x6DFB;&#x52A0;dns: <code>echo &quot;$(minikube ip) cheeses.minikube stilton.minikube&quot; | sudo tee -a /etc/hosts</code></p>
</li>
<li>&#x5F00;&#x542F;rbac&#xFF0C;&#x6388;&#x6743;&#x89D2;&#x8272;&#x8BBF;&#x95EE;dashboard&#x6743;&#x9650;<code>kubectl apply -f traefik-rbac.yaml</code></li>
<li><p>&#x8BBF;&#x95EE;<code>$(minikube ip):30423</code>&#x67E5;&#x770B;&#x5F53;&#x524D;Traefik&#x7684;dashboard</p>
<p> <img src="image/traefik_2.png" alt=""></p>
</li>
<li><p>&#x8BBF;&#x95EE;&#x4EE5;&#x4E0B;&#x5730;&#x5740;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6839;&#x636E;&#x8DEF;&#x7531;&#x89C4;&#x5219;&#x8FD4;&#x56DE;&#x4E86;&#x76F8;&#x5E94;&#x7684;&#x670D;&#x52A1;&#x9875;&#x9762;&#xFF1B;&#x8BBF;&#x95EE;&#x5176;&#x4ED6;&#x5730;&#x5740;&#x4F1A;&#x8FD4;&#x56DE;<code>404 not found</code></p>
<ul>
<li><code>http://stilton.minikube:32044/</code></li>
<li><code>http://cheeses.minikube:32044/cheddar</code></li>
<li><code>http://cheeses.minikube:32044/wensleydale</code></li>
</ul>
</li>
</ol>
<h1 id="&#x901A;&#x8FC7;configmap&#x5BF9;traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;"><a name="&#x901A;&#x8FC7;configmap&#x5BF9;traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;" class="anchor-navigation-ex-anchor" href="#&#x901A;&#x8FC7;configmap&#x5BF9;traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;"><i class="fa fa-link" aria-hidden="true"></i></a>3. &#x901A;&#x8FC7;ConfigMap&#x5BF9;Traefik&#x7F51;&#x5173;&#x8FDB;&#x884C;&#x914D;&#x7F6E;</h1>
<ol>
<li><p>&#x521B;&#x5EFA;ConfigMap&#xFF0C;&#x5728;k8s&#x4E0A;&#x6CE8;&#x518C;Traefik&#x914D;&#x7F6E;&#x8D44;&#x6E90;</p>
<pre class="language-"><code class="lang-js"> $ cat traefik<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> v1
 kind<span class="token punctuation">:</span> ConfigMap
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>config
   namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
 data<span class="token punctuation">:</span>
   traefik<span class="token punctuation">.</span>toml<span class="token punctuation">:</span> <span class="token operator">|</span>
     defaultEntryPoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">]</span>

     <span class="token punctuation">[</span>entryPoints<span class="token punctuation">]</span>
       <span class="token punctuation">[</span>entryPoints<span class="token punctuation">.</span>http<span class="token punctuation">]</span>
       address <span class="token operator">=</span> <span class="token string">&quot;:80&quot;</span>

     <span class="token punctuation">[</span>accessLog<span class="token punctuation">]</span>
     filePath <span class="token operator">=</span> <span class="token string">&quot;/logs/traefik.access.log&quot;</span>
     format <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span>

 $ kubectl apply <span class="token operator">-</span>f traefik<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml
</code></pre>
<p> &#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x505A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x914D;&#x7F6E;&#xFF0C;&#x8BBE;&#x7F6E;Traefik&#x7684;accesslog&#x4EE5;json&#x683C;&#x5F0F;&#x6253;&#x5370;&#x5230;<code>/logs/traefik.access.log</code>&#x8DEF;&#x5F84;&#x4E0B;&#x3002;</p>
<blockquote>
<p>&#x66F4;&#x591A;&#x4E30;&#x5BCC;&#x7684;Traefik&#x914D;&#x7F6E;&#x9009;&#x9879;&#x53EF;&#x4EE5;&#x67E5;&#x9605;&#x5B98;&#x65B9;&#x6587;&#x6863;&#xFF1A;<a href="https://docs.traefik.io/configuration/commons/" target="_blank">Traefik Configuration</a></p>
</blockquote>
</li>
<li><p>&#x8BA9;Traefik Deployment&#x5F15;&#x7528;ConfigMap&#x8D44;&#x6E90;</p>
<pre class="language-"><code class="lang-js">$ cat traefik<span class="token operator">-</span>deployment<span class="token punctuation">.</span>yaml
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> ServiceAccount
metadata<span class="token punctuation">:</span>
name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
<span class="token operator">--</span><span class="token operator">-</span>
kind<span class="token punctuation">:</span> Deployment
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
metadata<span class="token punctuation">:</span>
name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
labels<span class="token punctuation">:</span>
 k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
spec<span class="token punctuation">:</span>
replicas<span class="token punctuation">:</span> <span class="token number">2</span>
selector<span class="token punctuation">:</span>
 matchLabels<span class="token punctuation">:</span>
   k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
template<span class="token punctuation">:</span>
 metadata<span class="token punctuation">:</span>
   labels<span class="token punctuation">:</span>
     k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
     name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
 spec<span class="token punctuation">:</span>
   serviceAccountName<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
   terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">60</span>
   containers<span class="token punctuation">:</span>
   <span class="token operator">-</span> image<span class="token punctuation">:</span> traefik
     name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
     ports<span class="token punctuation">:</span>
     <span class="token operator">-</span> name<span class="token punctuation">:</span> http
       containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
     <span class="token operator">-</span> name<span class="token punctuation">:</span> admin
       containerPort<span class="token punctuation">:</span> <span class="token number">8080</span>
     args<span class="token punctuation">:</span>
     <span class="token operator">-</span> <span class="token operator">--</span>configfile<span class="token operator">=</span><span class="token operator">/</span>config<span class="token operator">/</span>traefik<span class="token punctuation">.</span>toml
     <span class="token operator">-</span> <span class="token operator">--</span>api
     <span class="token operator">-</span> <span class="token operator">--</span>kubernetes
     <span class="token operator">-</span> <span class="token operator">--</span>logLevel<span class="token operator">=</span><span class="token constant">INFO</span>
     volumeMounts<span class="token punctuation">:</span>
     <span class="token operator">-</span> mountPath<span class="token punctuation">:</span> <span class="token operator">/</span>config
       name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>config
     <span class="token operator">-</span> mountPath<span class="token punctuation">:</span> <span class="token operator">/</span>logs
       name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>log
   volumes<span class="token punctuation">:</span>
   <span class="token operator">-</span> name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>config
     configMap<span class="token punctuation">:</span>
       name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>config
   <span class="token operator">-</span> name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>log
     hostPath<span class="token punctuation">:</span>
       path<span class="token punctuation">:</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>log<span class="token operator">/</span>traefik
<span class="token operator">--</span><span class="token operator">-</span>
kind<span class="token punctuation">:</span> Service
apiVersion<span class="token punctuation">:</span> v1
metadata<span class="token punctuation">:</span>
name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>service
namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
spec<span class="token punctuation">:</span>
selector<span class="token punctuation">:</span>
 k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
ports<span class="token punctuation">:</span>
 <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
   port<span class="token punctuation">:</span> <span class="token number">80</span>
   nodePort<span class="token punctuation">:</span> <span class="token number">30036</span>
   name<span class="token punctuation">:</span> web
 <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
   port<span class="token punctuation">:</span> <span class="token number">8080</span>
   nodePort<span class="token punctuation">:</span> <span class="token number">30037</span>
   name<span class="token punctuation">:</span> admin
type<span class="token punctuation">:</span> NodePort

$ kubectl apply <span class="token operator">-</span>f traefik<span class="token operator">-</span>deployment<span class="token punctuation">.</span>yaml
</code></pre>
<ul>
<li>&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x901A;&#x8FC7;<code>volumeMounts</code>&#x5C06;&#x4E4B;&#x524D;&#x6CE8;&#x518C;&#x7684;ConfigMap&#x8D44;&#x6E90;<code>traefik-config</code>&#x6302;&#x8F7D;&#x5230;&#x5BB9;&#x5668;&#x7684;<code>/config</code>&#x76EE;&#x5F55;&#x4E0B;&#xFF1B;&#x5E76;&#x4E14;&#x5236;&#x5B9A;&#x542F;&#x52A8;Traefik&#x7684;&#x53C2;&#x6570;<code>args: --configfile=/config/traefik.toml</code>&#xFF0C;&#x4F7F;&#x7528;<code>traefik.toml</code>&#x7684;&#x914D;&#x7F6E;</li>
<li>&#x901A;&#x8FC7;<code>volumeMounts</code>&#x5C06;&#x5BB9;&#x5668;&#x7684;&#x65E5;&#x5FD7;&#x6302;&#x8F7D;&#x5230;&#x5BBF;&#x4E3B;&#x673A;&#x7684;<code>/tmp/log/traefik</code>&#x76EE;&#x5F55;&#x4E0B;</li>
</ul>
</li>
<li><p>&#x542F;&#x52A8;Traefik&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x73B0;&#x5BBF;&#x4E3B;&#x673A;&#x7684;<code>/tmp/log/traefik</code>&#x76EE;&#x5F55;&#x4E0B;&#x51FA;&#x73B0;&#x4E86;<code>traefik.access.log</code></p>
</li>
<li><p>&#x8BBF;&#x95EE;<code>localhost:30036</code>&#xFF0C;&#x5373;&#x53EF;&#x5728;<code>traefik.access.log</code>&#x4E2D;&#x770B;&#x5230;&#x8BF7;&#x6C42;&#x65E5;&#x5FD7;</p>
<pre class="language-"><code class="lang-js"> $ tail <span class="token operator">-</span>f <span class="token operator">/</span>tmp<span class="token operator">/</span>log<span class="token operator">/</span>traefik<span class="token operator">/</span>traefik<span class="token punctuation">.</span>access<span class="token punctuation">.</span>log
 <span class="token punctuation">{</span><span class="token string">&quot;BackendAddr&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;BackendName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Traefik&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;BackendURL&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;Scheme&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Opaque&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">&quot;Host&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Path&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RawPath&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ForceQuery&quot;</span><span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token string">&quot;RawQuery&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Fragment&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;ClientAddr&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;192.168.65.3:54144&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ClientHost&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;192.168.65.3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ClientPort&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;54144&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ClientUsername&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;DownstreamContentSize&quot;</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">&quot;DownstreamStatus&quot;</span><span class="token punctuation">:</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token string">&quot;DownstreamStatusLine&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;404 Not Found&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Duration&quot;</span><span class="token punctuation">:</span><span class="token number">264044</span><span class="token punctuation">,</span><span class="token string">&quot;FrontendName&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;backend not found&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;OriginContentSize&quot;</span><span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">&quot;OriginDuration&quot;</span><span class="token punctuation">:</span><span class="token number">20445</span><span class="token punctuation">,</span><span class="token string">&quot;OriginStatus&quot;</span><span class="token punctuation">:</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token string">&quot;OriginStatusLine&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;404 Not Found&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;Overhead&quot;</span><span class="token punctuation">:</span><span class="token number">243599</span><span class="token punctuation">,</span><span class="token string">&quot;RequestAddr&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;localhost:30036&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestContentSize&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;RequestCount&quot;</span><span class="token punctuation">:</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token string">&quot;RequestHost&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestLine&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;GET / HTTP/1.1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestMethod&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestPath&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestPort&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;30036&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RequestProtocol&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;HTTP/1.1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;RetryAttempts&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;StartLocal&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2019-04-17T10:19:18.315341342Z&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;StartUTC&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2019-04-17T10:19:18.315341342Z&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;downstream_Content-Type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text/plain; charset=utf-8&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;downstream_X-Content-Type-Options&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nosniff&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;origin_Content-Type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text/plain; charset=utf-8&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;origin_X-Content-Type-Options&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;nosniff&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;request_Accept&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;*/*&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;request_User-Agent&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;curl/7.51.0&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2019-04-17T10:19:18Z&quot;</span><span class="token punctuation">}</span>
</code></pre>
</li>
</ol>
<h1 id="&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;"><a name="&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;" class="anchor-navigation-ex-anchor" href="#&#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;"><i class="fa fa-link" aria-hidden="true"></i></a>4. &#x914D;&#x7F6E;&#x670D;&#x52A1;&#x4F18;&#x5148;&#x7EA7;</h1>
<p>Traefik-Ingress&#x8DEF;&#x7531;&#x9ED8;&#x8BA4;&#x91C7;&#x7528;&#x6700;&#x957F;&#x8DEF;&#x5F84;&#x5339;&#x914D;&#x539F;&#x5219;&#xFF0C;&#x6BD4;&#x5982;&#x4EE5;&#x4E0B;&#x4E24;&#x4E2A;Ingress&#x90FD;&#x4F7F;&#x7528;&#x524D;&#x7F00;&#x5339;&#x914D;</p>
<pre class="language-"><code class="lang-js">$ cat cheddar<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> cheddar
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>cheddar
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> cheddar
          servicePort<span class="token punctuation">:</span> http

$ cat wensleydale<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> wensleydale
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>cheddar<span class="token operator">/</span>wensleydale
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> wensleydale
          servicePort<span class="token punctuation">:</span> http
</code></pre>
<p>&#x6211;&#x4EEC;&#x8F7D;&#x5165;&#x8FD9;&#x4E24;&#x4E2A;Ingress&#xFF1A;<code>kubectl apply -f cheddar-ingress.yaml</code>&#xFF0C;<code>kubectl apply -f wensleydale-ingress.yaml</code>&#xFF0C;&#x5F53;&#x4F60;&#x8BBF;&#x95EE;<code>cheeses.minikube:32044/cheddar/wensleydale/xxx</code>&#x65F6;&#xFF0C;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x5206;&#x53D1;&#x5230;wensleydale&#x670D;&#x52A1;&#x4E0A;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x6307;&#x5B9A;&#x8DEF;&#x7531;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x4F7F;&#x7528;<code>traefik.ingress.kubernetes.io/priority</code>&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x503C;&#x8D8A;&#x5927;&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x8D8A;&#x9AD8;&#x3002;</p>
<pre class="language-"><code class="lang-js">$ cat cheddar<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> cheddar
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
    traefik<span class="token punctuation">.</span>ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>priority<span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span>
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>cheddar
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> cheddar
          servicePort<span class="token punctuation">:</span> http

$ cat wensleydale<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> wensleydale
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
    traefik<span class="token punctuation">.</span>ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>priority<span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>cheddar<span class="token operator">/</span>wensleydale
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> wensleydale
          servicePort<span class="token punctuation">:</span> http
</code></pre>
<p>&#x6B64;&#x65F6;&#x8BBF;&#x95EE;<code>cheeses.minikube:32044/cheddar/wensleydale/xxx</code>&#x65F6;&#xFF0C;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x5206;&#x53D1;&#x5230;cheddar&#x670D;&#x52A1;&#x4E0A;&#x3002;</p>
<blockquote>
<p>&#x9ED8;&#x8BA4;&#x4E0D;&#x8BBE;&#x7F6E;<code>traefik.ingress.kubernetes.io/priority</code>&#x65F6;&#x7684;&#x8DEF;&#x7531;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#xFF1B;&#x6240;&#x4EE5;&#x5EFA;&#x8BAE;&#x662F;&#x90FD;&#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x503C;&#xFF0C;&#x4EE5;&#x514D;&#x8BBE;&#x7F6E;&#x4E86;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x8DEF;&#x7531;&#x88AB;&#x672A;&#x8BBE;&#x7F6E;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x8DEF;&#x7531;&#x8986;&#x76D6;</p>
</blockquote>
<h1 id="&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><a name="&#x8D1F;&#x8F7D;&#x5747;&#x8861;" class="anchor-navigation-ex-anchor" href="#&#x8D1F;&#x8F7D;&#x5747;&#x8861;"><i class="fa fa-link" aria-hidden="true"></i></a>5. &#x8D1F;&#x8F7D;&#x5747;&#x8861;</h1>
<p>Traefik&#x53EF;&#x4EE5;&#x505A;&#x5230;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x3002;</p>
<p>&#x6BD4;&#x5982;&#x6211;&#x4EEC;&#x73B0;&#x5728;&#x6709;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#xFF0C;cheddar&#x548C;wensleydale&#xFF0C;&#x6211;&#x4EEC;&#x5E0C;&#x671B;&#x540C;&#x4E00;&#x4E2A;&#x5165;&#x53E3;75%&#x7684;&#x6D41;&#x91CF;&#x5BFC;&#x5411;cheddar&#xFF0C;25%&#x7684;&#x6D41;&#x91CF;&#x5BFC;&#x5411;wensleydale&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x505A;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;</p>
<pre class="language-"><code class="lang-js">$ cat cheeses<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> cheeses
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefixStrip
    traefik<span class="token punctuation">.</span>ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>service<span class="token operator">-</span>weights<span class="token punctuation">:</span> <span class="token operator">|</span>
      cheddar<span class="token punctuation">:</span> <span class="token number">75</span><span class="token operator">%</span>
      wensleydale<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> cheeses<span class="token punctuation">.</span>minikube
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> cheddar
          servicePort<span class="token punctuation">:</span> http
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token operator">/</span>
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> wensleydale
          servicePort<span class="token punctuation">:</span> http

$ kubectl apply <span class="token operator">-</span>f cheeses<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
<p>&#x63A5;&#x4E0B;&#x6765;&#x6279;&#x91CF;&#x8BBF;&#x95EE;<code>cheeses.minikube:32044/</code>&#xFF0C;&#x5C31;&#x4F1A;&#x53D1;&#x73B0;&#x6D41;&#x91CF;&#x6309;&#x7167;&#x6BD4;&#x4F8B;&#x88AB;&#x5BFC;&#x5165;&#x5230;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E0A;&#x53BB;&#x4E86;</p>
<p>Traefik&#x4E5F;&#x652F;&#x6301;&#x9ED8;&#x8BA4;&#x81EA;&#x52A8;&#x914D;&#x7F6E;&#x3002;&#x6BD4;&#x5982;&#x4E0A;&#x9762;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x53EA;&#x914D;&#x7F6E;&#x4E86;<code>wensleydale: 25%</code>&#xFF0C;&#x5373;&#x4FBF;&#x4E0D;&#x914D;&#x7F6E;<code>cheddar: 75%</code>&#xFF0C;Traefik&#x4E5F;&#x4F1A;&#x628A;&#x4F59;&#x4E0B;75%&#x7684;&#x6D41;&#x91CF;&#x81EA;&#x52A8;&#x5BFC;&#x5165;&#x5230;cheddar&#x4E0A;&#x53BB;&#x3002;</p>
<blockquote>
<p>&#x8D1F;&#x8F7D;&#x5747;&#x8861;&#x7684;&#x4E24;&#x4E2A;&#x670D;&#x52A1;&#x4E2D;&#xFF0C;&#x4EFB;&#x610F;&#x4E00;&#x4E2A;&#x670D;&#x52A1;&#x672A;&#x542F;&#x7528;&#xFF0C;&#x8BE5;&#x89C4;&#x5219;&#x90FD;&#x4E0D;&#x4F1A;&#x751F;&#x6548;&#x3002;&#x5982;<code>cheddar</code>&#x670D;&#x52A1;&#x5173;&#x95ED;&#x7684;&#x8BDD;&#xFF0C;&#x8BBF;&#x95EE;<code>cheeses.minikube:32044/</code>&#x7684;&#x8BF7;&#x6C42;&#x5C31;&#x4F1A;&#x5168;&#x90E8;&#x8FD4;&#x56DE;<code>404 Not Found</code></p>
</blockquote>
<h1 id="&#x7070;&#x5EA6;&#x53D1;&#x5E03;"><a name="&#x7070;&#x5EA6;&#x53D1;&#x5E03;" class="anchor-navigation-ex-anchor" href="#&#x7070;&#x5EA6;&#x53D1;&#x5E03;"><i class="fa fa-link" aria-hidden="true"></i></a>6. &#x7070;&#x5EA6;&#x53D1;&#x5E03;</h1>
<h2 id="&#x5E94;&#x7528;&#x90E8;&#x7F72;"><a name="&#x5E94;&#x7528;&#x90E8;&#x7F72;" class="anchor-navigation-ex-anchor" href="#&#x5E94;&#x7528;&#x90E8;&#x7F72;"><i class="fa fa-link" aria-hidden="true"></i></a>6.1. &#x5E94;&#x7528;&#x90E8;&#x7F72;</h2>
<ol>
<li><p>&#x521B;&#x5EFA;&#x672C;&#x5730;&#x955C;&#x50CF;&#xFF0C;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;http&#x670D;&#x52A1;&#x5668;</p>
<blockquote>
<p>&#x6CE8;&#x610F;&#xFF0C;&#x5982;&#x679C;&#x8981;&#x4F7F;&#x7528;&#x672C;&#x5730;&#x955C;&#x50CF;&#x7684;&#x8BDD;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;minikube&#x865A;&#x62DF;&#x673A;&#xFF0C;&#x5426;&#x5219;&#x4F1A;&#x7531;&#x4E8E;&#x865A;&#x62DF;&#x673A;&#x73AF;&#x5883;&#x6CA1;&#x6709;&#x955C;&#x50CF;&#x800C;&#x5BFC;&#x81F4;&#x62C9;&#x53D6;&#x955C;&#x50CF;&#x5931;&#x8D25;</p>
</blockquote>
<pre class="language-"><code class="lang-js"> $ cat demo<span class="token punctuation">.</span>go
 <span class="token keyword">package</span> main

 <span class="token keyword">import</span> <span class="token punctuation">(</span>
     <span class="token string">&quot;fmt&quot;</span>
     <span class="token string">&quot;io&quot;</span>
     <span class="token string">&quot;log&quot;</span>
     <span class="token string">&quot;net/http&quot;</span>

     <span class="token string">&quot;github.com/gorilla/mux&quot;</span>
 <span class="token punctuation">)</span>

 type my404Handler struct<span class="token punctuation">{</span><span class="token punctuation">}</span>

 <span class="token function">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>my404Handler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">&quot;gm-v1: 404 not Found!\n&quot;</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token comment">// DemoServer the web server</span>
 func <span class="token function">DemoServer</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     gameid<span class="token punctuation">,</span> _ <span class="token punctuation">:</span><span class="token operator">=</span> mux<span class="token punctuation">.</span><span class="token function">Vars</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;gameid&quot;</span><span class="token punctuation">]</span>
     io<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;gm-v1: game %v\n&quot;</span><span class="token punctuation">,</span> gameid<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     router <span class="token punctuation">:</span><span class="token operator">=</span> mux<span class="token punctuation">.</span><span class="token function">NewRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     router<span class="token punctuation">.</span><span class="token function">HandleFunc</span><span class="token punctuation">(</span><span class="token string">&quot;/{gameid}/gm/call&quot;</span><span class="token punctuation">,</span> DemoServer<span class="token punctuation">)</span>
     router<span class="token punctuation">.</span>NotFoundHandler <span class="token operator">=</span> <span class="token operator">&amp;</span>my404Handler<span class="token punctuation">{</span><span class="token punctuation">}</span>
     log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> router<span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 $ cat Dockerfile
 <span class="token constant">FROM</span> golang<span class="token punctuation">:</span><span class="token number">1.9</span><span class="token number">.6</span>

 <span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>demo<span class="token punctuation">.</span>go <span class="token operator">/</span>go<span class="token operator">/</span>src<span class="token operator">/</span>
 <span class="token constant">WORKDIR</span> <span class="token operator">/</span>go<span class="token operator">/</span>src
 <span class="token constant">RUN</span> go <span class="token keyword">get</span> github<span class="token punctuation">.</span>com<span class="token operator">/</span>gorilla<span class="token operator">/</span>mux

 <span class="token constant">CMD</span> <span class="token punctuation">[</span><span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;run&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;demo.go&quot;</span><span class="token punctuation">]</span>

 $ docker build <span class="token operator">-</span>t demo<span class="token operator">-</span>gm<span class="token punctuation">:</span>v1 <span class="token punctuation">.</span>
</code></pre>
<ul>
<li>&#x6211;&#x4EEC;&#x5C06;&#x4E0A;&#x8FF0;&#x955C;&#x50CF;&#x6587;&#x4EF6;&#x4E2D;&#x7684;v1&#x6539;&#x6210;v2&#xFF0C;&#x518D;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;<code>demo-gm:v2</code>&#x955C;&#x50CF;</li>
</ul>
</li>
<li><p>&#x4F7F;&#x7528;Deployment&#x6A21;&#x5F0F;&#x90E8;&#x7F72;&#x5E94;&#x7528;&#x955C;&#x50CF;&#xFF0C;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</p>
<pre class="language-"><code class="lang-js"> $ cat gm<span class="token operator">-</span>v1<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Deployment
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
   labels<span class="token punctuation">:</span>
     app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
 spec<span class="token punctuation">:</span>
   replicas<span class="token punctuation">:</span> <span class="token number">2</span>
   selector<span class="token punctuation">:</span>
     matchLabels<span class="token punctuation">:</span>
       app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
   template<span class="token punctuation">:</span>
     metadata<span class="token punctuation">:</span>
       labels<span class="token punctuation">:</span>
         app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
     spec<span class="token punctuation">:</span>
       containers<span class="token punctuation">:</span>
       <span class="token operator">-</span> name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
         image<span class="token punctuation">:</span> demo<span class="token operator">-</span>gm<span class="token punctuation">:</span>v1
         ports<span class="token punctuation">:</span>
         <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">8080</span>
 <span class="token operator">--</span><span class="token operator">-</span>
 apiVersion<span class="token punctuation">:</span> v1
 kind<span class="token punctuation">:</span> Service
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
 spec<span class="token punctuation">:</span>
   ports<span class="token punctuation">:</span>
   <span class="token operator">-</span> name<span class="token punctuation">:</span> http
     port<span class="token punctuation">:</span> <span class="token number">80</span>
     targetPort<span class="token punctuation">:</span> <span class="token number">8080</span>
   selector<span class="token punctuation">:</span>
     app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1

 $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v1<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;Ingress&#x6CE8;&#x518C;&#x670D;&#x52A1;</p>
<pre class="language-"><code class="lang-js">$ cat gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
          servicePort<span class="token punctuation">:</span> http

$ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x542F;&#x52A8;traefik</p>
<pre class="language-"><code class="lang-js"> $ cat traefik<span class="token operator">-</span>deployment<span class="token punctuation">.</span>yaml
 <span class="token operator">--</span><span class="token operator">-</span>
 apiVersion<span class="token punctuation">:</span> v1
 kind<span class="token punctuation">:</span> ServiceAccount
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
   namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
 <span class="token operator">--</span><span class="token operator">-</span>
 kind<span class="token punctuation">:</span> Deployment
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
   namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
   labels<span class="token punctuation">:</span>
     k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
 spec<span class="token punctuation">:</span>
   replicas<span class="token punctuation">:</span> <span class="token number">2</span>
   selector<span class="token punctuation">:</span>
     matchLabels<span class="token punctuation">:</span>
       k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
   template<span class="token punctuation">:</span>
     metadata<span class="token punctuation">:</span>
       labels<span class="token punctuation">:</span>
         k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
         name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
     spec<span class="token punctuation">:</span>
       serviceAccountName<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>controller
       terminationGracePeriodSeconds<span class="token punctuation">:</span> <span class="token number">60</span>
       containers<span class="token punctuation">:</span>
       <span class="token operator">-</span> image<span class="token punctuation">:</span> traefik
         name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
         ports<span class="token punctuation">:</span>
         <span class="token operator">-</span> name<span class="token punctuation">:</span> http
           containerPort<span class="token punctuation">:</span> <span class="token number">80</span>
         <span class="token operator">-</span> name<span class="token punctuation">:</span> admin
           containerPort<span class="token punctuation">:</span> <span class="token number">8080</span>
         args<span class="token punctuation">:</span>
         <span class="token operator">-</span> <span class="token operator">--</span>api
         <span class="token operator">-</span> <span class="token operator">--</span>kubernetes
         <span class="token operator">-</span> <span class="token operator">--</span>logLevel<span class="token operator">=</span><span class="token constant">INFO</span>
 <span class="token operator">--</span><span class="token operator">-</span>
 kind<span class="token punctuation">:</span> Service
 apiVersion<span class="token punctuation">:</span> v1
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>service
   namespace<span class="token punctuation">:</span> kube<span class="token operator">-</span>system
 spec<span class="token punctuation">:</span>
   selector<span class="token punctuation">:</span>
     k8s<span class="token operator">-</span>app<span class="token punctuation">:</span> traefik<span class="token operator">-</span>ingress<span class="token operator">-</span>lb
   ports<span class="token punctuation">:</span>
     <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
       port<span class="token punctuation">:</span> <span class="token number">80</span>
       nodePort<span class="token punctuation">:</span> <span class="token number">30036</span>
       name<span class="token punctuation">:</span> web
     <span class="token operator">-</span> protocol<span class="token punctuation">:</span> <span class="token constant">TCP</span>
       port<span class="token punctuation">:</span> <span class="token number">8080</span>
       nodePort<span class="token punctuation">:</span> <span class="token number">30037</span>
       name<span class="token punctuation">:</span> admin
   type<span class="token punctuation">:</span> NodePort

 $ kubectl apply <span class="token operator">-</span>f traefik<span class="token operator">-</span>deployment<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x8BBF;&#x95EE;<code>gm-v1</code>&#x670D;&#x52A1;</p>
<pre class="language-"><code class="lang-js"> $ curl <span class="token string">&apos;localhost:30036/dm0/gm/call&apos;</span>
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0

 $ curl &apos;localhost<span class="token punctuation">:</span><span class="token number">30036</span><span class="token operator">/</span>dm0<span class="token operator">/</span>gm<span class="token operator">/</span>test
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> <span class="token number">404</span> not Found<span class="token operator">!</span>
</code></pre>
</li>
</ol>
<h2 id="&#x5E94;&#x7528;&#x5347;&#x7EA7;"><a name="&#x5E94;&#x7528;&#x5347;&#x7EA7;" class="anchor-navigation-ex-anchor" href="#&#x5E94;&#x7528;&#x5347;&#x7EA7;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2. &#x5E94;&#x7528;&#x5347;&#x7EA7;</h2>
<h3 id="&#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;"><a name="&#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;" class="anchor-navigation-ex-anchor" href="#&#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.1. &#x90E8;&#x7F72;gm-v2&#x670D;&#x52A1;</h3>
<pre class="language-"><code class="lang-js">$ cat gm<span class="token operator">-</span>v2<span class="token punctuation">.</span>yaml
apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Deployment
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
  labels<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
spec<span class="token punctuation">:</span>
  replicas<span class="token punctuation">:</span> <span class="token number">2</span>
  selector<span class="token punctuation">:</span>
    matchLabels<span class="token punctuation">:</span>
      app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
  template<span class="token punctuation">:</span>
    metadata<span class="token punctuation">:</span>
      labels<span class="token punctuation">:</span>
        app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
    spec<span class="token punctuation">:</span>
      containers<span class="token punctuation">:</span>
      <span class="token operator">-</span> name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
        image<span class="token punctuation">:</span> demo<span class="token operator">-</span>gm<span class="token punctuation">:</span>v2
        ports<span class="token punctuation">:</span>
        <span class="token operator">-</span> containerPort<span class="token punctuation">:</span> <span class="token number">8080</span>
<span class="token operator">--</span><span class="token operator">-</span>
apiVersion<span class="token punctuation">:</span> v1
kind<span class="token punctuation">:</span> Service
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
spec<span class="token punctuation">:</span>
  ports<span class="token punctuation">:</span>
  <span class="token operator">-</span> name<span class="token punctuation">:</span> http
    port<span class="token punctuation">:</span> <span class="token number">80</span>
    targetPort<span class="token punctuation">:</span> <span class="token number">8080</span>
  selector<span class="token punctuation">:</span>
    app<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2

$ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v2<span class="token punctuation">.</span>yaml
</code></pre>
<h3 id="50&#x7070;&#x5EA6;"><a name="50&#x7070;&#x5EA6;" class="anchor-navigation-ex-anchor" href="#50&#x7070;&#x5EA6;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.2. &quot;50%&quot;&#x7070;&#x5EA6;</h3>
<ol>
<li><p>&#x4F7F;&#x7528;Ingress&#x6CE8;&#x518C;<code>gm-v2</code>&#x670D;&#x52A1;</p>
<pre class="language-"><code class="lang-js"> $ cat gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Ingress
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
   annotations<span class="token punctuation">:</span>
     kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
     traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
 spec<span class="token punctuation">:</span>
   rules<span class="token punctuation">:</span>
   <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
           servicePort<span class="token punctuation">:</span> http

 $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x901A;&#x8FC7;<code>kubectl get ingress</code>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x6B64;&#x65F6;<code>gm-v1</code>&#x548C;<code>gm-v2</code>&#x662F;&#x5E76;&#x5B58;&#x7684;</p>
<pre class="language-"><code class="lang-js"> <span class="token constant">NAME</span>      <span class="token constant">HOSTS</span>       <span class="token constant">ADDRESS</span>   <span class="token constant">PORTS</span>     <span class="token constant">AGE</span>
 gm<span class="token operator">-</span>v1     localhost             <span class="token number">80</span>        <span class="token number">4</span>h
 gm<span class="token operator">-</span>v2     localhost             <span class="token number">80</span>        <span class="token number">3</span>h
</code></pre>
</li>
<li><p>&#x901A;&#x8FC7;&#x7B80;&#x5355;&#x7684;&#x7A0B;&#x5E8F;20&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#xFF0C;&#x6B64;&#x65F6;&#x201C;50%&#x201D;&#x7684;&#x6D41;&#x91CF;&#x88AB;&#x5206;&#x53D1;&#x5230;&#x4E86;<code>gm-v2</code></p>
<pre class="language-"><code class="lang-js"> gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 map<span class="token punctuation">[</span>unknown<span class="token punctuation">:</span><span class="token number">0</span> v1<span class="token punctuation">:</span><span class="token number">10</span> v2<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>
</code></pre>
<blockquote>
<p>&#x4E4B;&#x6240;&#x4EE5;&#x7ED9;&#x8FD9;&#x201C;50%&#x201D;&#x52A0;&#x4E2A;&#x5F15;&#x53F7;&#x662F;&#x56E0;&#x4E3A;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x6B64;&#x65F6;&#x7684;&#x6D41;&#x91CF;&#x4F1A;&#x5747;&#x5300;&#x5730;&#x5206;&#x53D1;&#x7ED9;gm-v1&#x548C;gm-v2&#x6240;&#x6709;&#x7684;pod&#xFF0C;&#x5982;&#x679C;gm-v1&#x542F;&#x52A8;&#x4E86;2&#x4E2A;pod&#xFF0C;gm-v2&#x542F;&#x52A8;&#x4E86;4&#x4E2A;pod&#xFF0C;&#x90A3;&#x4E48;&#x5206;&#x53D1;&#x5230;gm-v1&#x548C;gm-v2&#x7684;&#x6D41;&#x91CF;&#x4E3A;<code>1:2</code></p>
</blockquote>
</li>
<li><p>&#x901A;&#x8FC7;<code>kubectl delete ingress gm-v1</code>&#xFF0C;&#x5220;&#x9664;<code>gm-v1</code>&#x7684;&#x8DEF;&#x7531;</p>
</li>
<li><p>&#x7136;&#x540E;&#x518D;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#xFF0C;&#x53EF;&#x4EE5;&#x53D1;&#x73B0;&#x6D41;&#x91CF;&#x5168;&#x90E8;&#x5230;&#x5206;&#x53D1;&#x5230;&#x4E86;<code>gm-v2</code></p>
<pre class="language-"><code class="lang-js"> gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 map<span class="token punctuation">[</span>v1<span class="token punctuation">:</span><span class="token number">0</span> v2<span class="token punctuation">:</span><span class="token number">20</span> unknown<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
</li>
</ol>
<h3 id="&#x7CBE;&#x51C6;&#x7070;&#x5EA6;"><a name="&#x7CBE;&#x51C6;&#x7070;&#x5EA6;" class="anchor-navigation-ex-anchor" href="#&#x7CBE;&#x51C6;&#x7070;&#x5EA6;"><i class="fa fa-link" aria-hidden="true"></i></a>6.2.3. &#x7CBE;&#x51C6;&#x7070;&#x5EA6;</h3>
<ol>
<li><p>&#x901A;&#x8FC7;Ingress&#x6CE8;&#x518C;/dm0/gm&#x8BBF;&#x95EE;gm-v1&#x670D;&#x52A1;&#xFF0C;&#x6B64;&#x65F6;&#x6D41;&#x91CF;&#x5168;&#x90E8;&#x8F6C;&#x53D1;&#x5230;gm-v1</p>
<pre class="language-"><code class="lang-js"> $ cat gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Ingress
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> dm0<span class="token operator">-</span>gm
   annotations<span class="token punctuation">:</span>
     kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
     traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
 spec<span class="token punctuation">:</span>
   rules<span class="token punctuation">:</span>
   <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
           servicePort<span class="token punctuation">:</span> http

 $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x4F7F;&#x7528;&#x540C;&#x6837;&#x7684;name(dm0-gm)&#xFF0C;&#x6CE8;&#x518C;&#x7070;&#x5EA6;&#x8DEF;&#x7531;&#xFF1B;&#x6B64;&#x65F6;&#x7531;&#x4E8E;Ingress name&#x76F8;&#x540C;&#xFF0C;&#x4F1A;&#x8986;&#x76D6;&#x4E4B;&#x524D;&#x7684;&#x8DEF;&#x7531;</p>
<pre class="language-"><code class="lang-js"> $ cat gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Ingress
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> dm0<span class="token operator">-</span>gm
   annotations<span class="token punctuation">:</span>
     kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
     traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
     traefik<span class="token punctuation">.</span>ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>service<span class="token operator">-</span>weights<span class="token punctuation">:</span> <span class="token operator">|</span>
       gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> <span class="token number">75</span><span class="token operator">%</span>
       gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> <span class="token number">25</span><span class="token operator">%</span>
 spec<span class="token punctuation">:</span>
   rules<span class="token punctuation">:</span>
   <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
           servicePort<span class="token punctuation">:</span> http
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
           servicePort<span class="token punctuation">:</span> http

 $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x6B64;&#x65F6;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;25%&#x7684;&#x6D41;&#x91CF;&#x88AB;&#x8F6C;&#x53D1;&#x5230;&#x4E86;<code>gm-v2</code></p>
<pre class="language-"><code class="lang-js"> gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v1<span class="token punctuation">:</span> game dm0
 map<span class="token punctuation">[</span>v2<span class="token punctuation">:</span><span class="token number">4</span> unknown<span class="token punctuation">:</span><span class="token number">0</span> v1<span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span>
</code></pre>
</li>
<li><p>&#x66F4;&#x65B0;Ingress: <code>dm0-gm</code></p>
<pre class="language-"><code class="lang-js"> $ cat gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
 apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
 kind<span class="token punctuation">:</span> Ingress
 metadata<span class="token punctuation">:</span>
   name<span class="token punctuation">:</span> dm0<span class="token operator">-</span>gm
   annotations<span class="token punctuation">:</span>
     kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
     traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
 spec<span class="token punctuation">:</span>
   rules<span class="token punctuation">:</span>
   <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
     http<span class="token punctuation">:</span>
       paths<span class="token punctuation">:</span>
       <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
         backend<span class="token punctuation">:</span>
           serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v2
           servicePort<span class="token punctuation">:</span> http

 $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v2<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
</li>
<li><p>&#x6B64;&#x65F6;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x6240;&#x6709;&#x6D41;&#x91CF;&#x90FD;&#x88AB;&#x8F6C;&#x53D1;&#x5230;&#x4E86;<code>gm-v2</code></p>
<pre class="language-"><code class="lang-js"> gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 gm<span class="token operator">-</span>v2<span class="token punctuation">:</span> game dm0
 map<span class="token punctuation">[</span>v1<span class="token punctuation">:</span><span class="token number">0</span> v2<span class="token punctuation">:</span><span class="token number">20</span> unknown<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre>
</li>
</ol>
<h1 id="ip&#x9650;&#x5236;"><a name="ip&#x9650;&#x5236;" class="anchor-navigation-ex-anchor" href="#ip&#x9650;&#x5236;"><i class="fa fa-link" aria-hidden="true"></i></a>7. IP&#x9650;&#x5236;</h1>
<p>Traefik&#x652F;&#x6301;&#x5BF9;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x505A;ip&#x767D;&#x540D;&#x5355;&#x9650;&#x5236;</p>
<pre class="language-"><code class="lang-js">$ cat gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> dm0<span class="token operator">-</span>gm
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm0/gm</span>
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
          servicePort<span class="token punctuation">:</span> http

<span class="token operator">--</span><span class="token operator">-</span>

apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
kind<span class="token punctuation">:</span> Ingress
metadata<span class="token punctuation">:</span>
  name<span class="token punctuation">:</span> dm1<span class="token operator">-</span>gm
  annotations<span class="token punctuation">:</span>
    kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
    traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
    traefik<span class="token punctuation">.</span>ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>whitelist<span class="token operator">-</span>source<span class="token operator">-</span>range<span class="token punctuation">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
spec<span class="token punctuation">:</span>
  rules<span class="token punctuation">:</span>
  <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
    http<span class="token punctuation">:</span>
      paths<span class="token punctuation">:</span>
      <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm1/gm</span>
        backend<span class="token punctuation">:</span>
          serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
          servicePort<span class="token punctuation">:</span> http

$ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
<ul>
<li>&#x6B64;&#x65F6;&#xFF0C;&#x8BBF;&#x95EE;<code>/dm1/gm</code>&#x7684;&#x6765;&#x6E90;ip&#x82E5;&#x4E0D;&#x662F;127.0.0.1&#xFF0C;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x4F1A;&#x8FD4;&#x56DE;<code>403 Forbidden</code>&#xFF1B;&#x8BBF;&#x95EE;<code>dm0/gm</code>&#x7684;&#x4E0D;&#x53D7;ip&#x9650;&#x5236;</li>
<li>&#x4E5F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;<code>ingress.kubernetes.io/whitelist-x-forwarded-for: &quot;true&quot;</code>&#xFF0C;&#x4F7F;&#x7528;HTTP&#x5934;&#x90E8;&#x7684;<code>X-Forwarded-For</code>&#x5B57;&#x6BB5;&#x7684;ip&#x505A;&#x6821;&#x9A8C;</li>
<li>&#x652F;&#x6301;&#x591A;ip&#x548C;&#x901A;&#x914D;&#x7B26;&#xFF0C;&#x5982;<code>traefik.ingress.kubernetes.io/whitelist-source-range: &quot;1.2.3.0/24, fe80::/16&quot;</code></li>
</ul>
<h1 id="&#x5B9A;&#x5236;header"><a name="&#x5B9A;&#x5236;header" class="anchor-navigation-ex-anchor" href="#&#x5B9A;&#x5236;header"><i class="fa fa-link" aria-hidden="true"></i></a>8. &#x5B9A;&#x5236;Header</h1>
<ul>
<li><p>&#x5B9A;&#x5236;&#x8BF7;&#x6C42;&#x5934;</p>
<pre class="language-"><code class="lang-js">  $ cat gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
  apiVersion<span class="token punctuation">:</span> extensions<span class="token operator">/</span>v1beta1
  kind<span class="token punctuation">:</span> Ingress
  metadata<span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> dm2<span class="token operator">-</span>gm
    annotations<span class="token punctuation">:</span>
      kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>ingress<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">:</span> traefik
      traefik<span class="token punctuation">.</span>frontend<span class="token punctuation">.</span>rule<span class="token punctuation">.</span>type<span class="token punctuation">:</span> PathPrefix
      ingress<span class="token punctuation">.</span>kubernetes<span class="token punctuation">.</span>io<span class="token operator">/</span>custom<span class="token operator">-</span>request<span class="token operator">-</span>headers<span class="token punctuation">:</span> <span class="token string">&quot;X-Custom-Id: test&quot;</span>
  spec<span class="token punctuation">:</span>
    rules<span class="token punctuation">:</span>
    <span class="token operator">-</span> host<span class="token punctuation">:</span> localhost
      http<span class="token punctuation">:</span>
        paths<span class="token punctuation">:</span>
        <span class="token operator">-</span> path<span class="token punctuation">:</span> <span class="token regex">/dm2/gm</span>
          backend<span class="token punctuation">:</span>
            serviceName<span class="token punctuation">:</span> gm<span class="token operator">-</span>v1
            servicePort<span class="token punctuation">:</span> http

  $ kubectl apply <span class="token operator">-</span>f gm<span class="token operator">-</span>v1<span class="token operator">-</span>ingress<span class="token punctuation">.</span>yaml
</code></pre>
<ul>
<li>&#x540E;&#x7AEF;&#x6536;&#x5230;&#x7684;&#x8BF7;&#x6C42;&#x4E2D;&#x4F1A;&#x5305;&#x542B;&#x8BF7;&#x6C42;&#x5934;<code>X-Custom-Id</code></li>
<li>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<code>&quot;Header1: Value1||Header2: Value2||...</code>&#x7684;&#x65B9;&#x5F0F;&#x8BBE;&#x5B9A;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;&#x5934;</li>
<li><p>&#x7ECF;&#x8FC7;traefik&#x53CD;&#x5411;&#x4EE3;&#x7406;&#x8F6C;&#x53D1;&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x81EA;&#x52A8;&#x5E26;&#x4E0A;&#x4EE5;&#x4E0B;&#x5934;&#x90E8;</p>
<ul>
<li><code>X-Forwarded-Host</code></li>
<li><code>X-Forwarded-Port</code></li>
<li><code>X-Forwarded-Server</code></li>
<li><code>X-Forwarded-For</code></li>
<li><code>X-Real-Ip</code></li>
<li><code>X-Forwarded-Proto</code></li>
<li><code>User-Agent</code></li>
<li><code>Accept-Encoding</code></li>
</ul>
</li>
</ul>
</li>
<li><p>&#x5B9A;&#x5236;&#x8FD4;&#x56DE;&#x5934;&#x7684;&#x65B9;&#x6CD5;&#x548C;&#x8BF7;&#x6C42;&#x5934;&#x4E00;&#x6837;&#xFF0C;&#x53EA;&#x662F;annotations&#x6362;&#x6210;&#x4E86;<code>ingress.kubernetes.io/custom-response-headers</code></p>
</li>
</ul>
<blockquote>
<p>&#x53C2;&#x8003;&#x94FE;&#x63A5;</p>
<ul>
<li><a href="https://docs.traefik.io/user-guide/kubernetes/" target="_blank">traefik kubernetes user guide</a></li>
<li><a href="https://docs.traefik.io/configuration/backends/kubernetes/" target="_blank">traefik ingress provider</a></li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank">kubernetes ingress</a></li>
<li><a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/kubernetes-objects/" target="_blank">kubernetes&#x5B98;&#x7F51;</a></li>
<li><a href="http://hardocs.com/d/kubernetes/149-kubectl_describe.html" target="_blank">kubernetes&#x4E2D;&#x6587;&#x624B;&#x518C;</a></li>
<li><a href="https://www.cnblogs.com/zhaojiankai/p/7898282.html" target="_blank">&#x4F8B;&#x7A0B;1</a></li>
<li><a href="https://www.qikqiak.com/post/ingress-traefik1/" target="_blank">&#x4F8B;&#x7A0B;2</a></li>
<li><a href="https://www.cnblogs.com/breezey/p/9113951.html" target="_blank">&#x4F7F;&#x7528;traefik&#x4F5C;&#x4E3A;kubernetes&#x7684;ingress</a></li>
</ul>
</blockquote>

<script>console.log("plugin-popup....");document.onclick = function(e){ e.target.tagName === "IMG" && window.open(e.target.src,e.target.src)}</script><style>img{cursor:pointer}</style>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                
                <a href="configmap.html" class="navigation navigation-next navigation-unique" aria-label="Next page: II. ConfigMap的使用">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"I. Kubernetes使用Traefik反向代理","level":"1.7.1","depth":2,"next":{"title":"II. ConfigMap的使用","level":"1.7.2","depth":2,"path":"kubernetes/configmap.md","ref":"./kubernetes/configmap.md","articles":[]},"previous":{"title":"Kubernetes相关","level":"1.7","depth":1,"ref":"","articles":[{"title":"I. Kubernetes使用Traefik反向代理","level":"1.7.1","depth":2,"path":"kubernetes/traefik.md","ref":"./kubernetes/traefik.md","articles":[]},{"title":"II. ConfigMap的使用","level":"1.7.2","depth":2,"path":"kubernetes/configmap.md","ref":"./kubernetes/configmap.md","articles":[]},{"title":"附. 部分指令参考","level":"1.7.3","depth":2,"path":"kubernetes/commands.md","ref":"./kubernetes/commands.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","search-pro","anchor-navigation-ex","-highlight","prism","prism-themes","-sharing","sharing-plus","popup"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prism-themes/themes/prism-base16-ateliersulphurpool.light.css"],"lang":{"flow":"typescript"},"ignore":["mermaid","eval-js"]},"search-pro":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"popup":{},"fontsettings":{"theme":"white","family":"sans","size":2},"anchor-navigation-ex":{"mode":"float","pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"showLevel":true,"tocLevel2Icon":"fa fa-hand-o-right","tocLevel3Icon":"fa fa-hand-o-right","showGoTop":true,"isShowTocTitleIcon":true,"tocLevel4Icon":"fa fa-hand-o-right","printLog":false,"multipleH1":true,"associatedWithSummary":false,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false}},"prism-themes":{},"sharing":{"douban":true,"facebook":true,"google":true,"qq":true,"qzone":true,"twitter":true,"weibo":true,"all":["douban","facebook","google","instapaper","linkedin","twitter","weibo","messenger","qq","qzone","viber","whatsapp"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"mania_fish<mania_fish@163.com>","pdf":{"pageBreaksBefore":"/","headerTemplate":null,"paperSize":"a4","margin":{"right":62,"left":62,"top":36,"bottom":36},"fontSize":12,"fontFamily":"Arial","footerTemplate":null,"chapterMark":"pagebreak","pageNumbers":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"maniafish's technology blog","links":{"sidebar":{"github 主页":"https://github.com/maniafish/tech_talk/"}},"gitbook":"*","description":"technology note","extension":null},"file":{"path":"kubernetes/traefik.md","mtime":"2019-05-20T03:24:05.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-10-13T02:35:23.427Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

